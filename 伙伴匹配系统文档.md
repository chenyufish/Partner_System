#  伙伴匹配系统（移动端的H5网页）

介绍：帮助大家找到志同道合的伙伴，移动端 H5 网页（尽量兼容 PC 端）

## 需求分析

1. 用户去添加标签，标签的分类（要有哪些标签、怎么把标签进行分类）学习方向 java / c++，工作 / 大学
2. 主动搜索：允许用户根据标签去搜索其他用户 

1. 1. Redis 缓存

1. 组队 

1. 1. 创建队伍
   2. 加入队伍
   3. 根据标签查询队伍
   4. 邀请其他人

1. 允许用户去修改标签
2. 推荐 

1. 1. 相似度计算算法 + 本地分布式计算

## 技术栈

### 前端

1. Vue 3 开发框架（提高页面开发的效率）
2. Vant UI（基于 Vue 的移动端组件库）（React 版 Zent）
3. Vite 2（打包工具，快！）
4. Nginx 来单机部署

### 后端

1. Java 编程语言 + SpringBoot 框架
2. SpringMVC + MyBatis + MyBatis Plus（提高开发效率）
3. MySQL 数据库
4. Redis 缓存
5. Swagger + Knife4j 接口文档

# 前端主页+组件概览

### 设计

导航条：展示当前页面名称

主页搜索框 => 搜索页 => 搜索结果页（标签筛选页）

内容

tab 栏：

- 主页（推荐页 + **广告** ）

- - 搜索框
  - banner
  - 推荐信息流

- 队伍页
- 用户页（消息 - 暂时考虑发邮件）

### 开发

很多页面要复用组件 / 样式，重复写很麻烦、不利于维护，所以抽象一个通用的布局（Layout）组件化（抽象布局实现代码复用）

# 新增标签表（分类表）

建议用标签，不要用分类，更灵活。

（如果分类可以写死在后端就直接枚举类，但事实上用户会自己定义标签，所以我们建立一个标签表）

性别：男、女

方向：Java、C++、Go、前端

正在学：Spring

目标：考研、春招、秋招、社招、考公、竞赛（蓝桥杯）、转行、跳槽

段位：初级、中级、高级、王者

身份：小学、初中、高中、大一、大二、大三、大四、学生、待业、已就业、研一、研二、研三

状态：乐观、有点丧、一般、单身、已婚、有对象



字段：

id int 主键

标签名 varchar 非空（必须唯一，唯一索引）

上传标签的用户 userId int（如果要根据 userId 查已上传标签的话，最好加上，普通索引）

父标签 id ，parentId，int（分类）

是否为父标签 isParent, tinyint（0 不是父标签、1 - 父标签）

创建时间 createTime，datetime

更新时间 updateTime，datetime

是否删除 isDelete， tinyint（0、1）



怎么查询所有标签，并且把标签分好组？按父标签 id 分组，能实现 

根据父标签查询子标签？根据 id 查询，能实现 √



SQL 语言分类：

DDL define 建表、操作表

DML manage 更新删除数据，影响实际表里的内容

DCL control 控制，权限

DQL query 查询，select

### 修改用户表的方法

用户有哪些标签？

**** 此处选择第一种

1. 直接在用户表补充 tags 字段，**['Java', '男'] 存 json 字符串** 优点：查询方便、不用新建关联表，标签是用户的固有属性（除了该系统、其他系统可能要用到，标签是用户的固有属性）节省开发成本**查询用户列表，查关系表拿到这 100 个用户有的所有标签 id，再根据标签 id 去查标签表。**哪怕性能低，可以用缓存。缺点：用户表多一列，会有点
2. 加一个关联表，记录用户和标签的关系关联表的应用场景：查询灵活，可以正查反查缺点：要多建一个表、多维护一个表重点：企业大项目开发中尽量减少关联查询，很影响扩展性，而且会影响查询性能

# 开发后端接口

####  搜索标签

1. 允许用户传入多个标签，多个标签都存在才搜索出来 and。like '%Java%' and like '%C++%'。

2. 允许用户传入多个标签，有任何一个标签存在就能搜索出来 or。like '%Java%' or like '%C++%'

两种方式：

1. SQL 查询（实现简单，可以通过拆分查询进一步优化）

2. 内存查询（灵活，可以通过并发进一步优化）

\- 如果参数可以分析，根据用户的参数去选择查询方式，比如标签数

\- 如果参数不可分析，并且数据库连接足够、内存空间足够，可以并发同时查询，谁先返回用谁。

\- 还可以 SQL 查询与内存计算相结合，比如先用 SQL 过滤掉部分 tag

建议通过实际测试来分析哪种查询比较快，数据量大的时候验证效果更明显！

解析 JSON 字符串：

序列化：java对象转成 json

反序列化：把 json 转为 java 对象

java  json 序列化库有很多：

1. **gson**（google 的）

2. fastjson alibaba（ali 出品，快，但是漏洞太多）

3. jackson

4. kryo

# 前端

1. 前端整合路由 
2. 前端开发（搜索页面、用户信息页、用户信息修改页）
3. 后端整合 Swagger + Knife4j 接口文档 
4. 存量用户信息导入及同步（爬虫） 



# 后端整合 Swagger + Knife4j 接口文档

什么是接口文档？写接口信息的文档，每条接口包括：

- 请求参数
- 响应参数

- - 错误码

- 接口地址
- 接口名称
- 请求类型
- 请求格式
- 备注

who 谁用？一般是后端或者负责人来提供，后端和前端都要使用

为什么需要接口文档？

- 有个书面内容（背书或者归档），便于大家参考和查阅，便于 **沉淀和维护** ，拒绝口口相传
- 接口文档便于前端和后端开发对接，前后端联调的 **介质** 。后端 => 接口文档 <= 前端
- 好的接口文档支持在线调试、在线测试，可以作为工具提高我们的开发测试效率

怎么做接口文档？

- 手写（比如腾讯文档、Markdown 笔记）
- 自动化接口文档生成：自动根据项目代码生成完整的文档或在线调试的网页。Swagger，Postman（侧重接口管理）（国外）；apifox、apipost、eolink（国产）

接口文档有哪些技巧？

Swagger 原理：

1. 引入依赖（Swagger 或 Knife4j：https://doc.xiaominfo.com/knife4j/documentation/get_start.html）
2. 自定义 Swagger 配置类
3. 定义需要生成接口文档的代码位置（Controller）
4. 千万注意：线上环境不要把接口暴露出去！！！可以通过在 SwaggerConfig 配置文件开头加上 @Profile({"dev", "test"}) 限定配置仅在部分环境开启
5. 启动即可
6. 可以通过在 controller 方法上添加 @Api、@ApiImplicitParam(name = "name",value = "姓名",required = true) @ApiOperation(value = "向客人问好") 等注解来自定义生成的接口描述信息

如果 springboot version >= 2.6，需要添加如下配置：

```yaml
spring:
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
```

可以通过在 controller 方法上添加 @Api、@ApiImplicitParam(name = "name",value = "姓名",required = true) @ApiOperation(value = "向客人问好") 等注解来自定义生成的接口描述信息。

千万注意：线上环境不要把接口暴露出去！！！可以通过在 SwaggerConfig 配置文件开头加上 @Profile({"dev", "test"}) 限定配置仅在部分环境开启

knife4j对比swagger来说，虽然可视化增强了，但是不能进行接口管理

# 分布式 session

种 session 的时候注意范围，cookie.domain

比如两个域名：

aaa.yupi.com

bbb.yupi.com

如果要共享 cookie，可以种一个更高层的公共域名，比如 yupi.com

### 为什么服务器 A 登录后，请求发到服务器 B，不认识该用户？

用户在 A 登录，所以 session（用户登录信息）存在了 A 上

结果请求 B 时，B 没有用户信息，所以不认识。

![image.png](https://cdn.nlark.com/yuque/0/2022/png/26770555/1669261508769-827a7a9d-0154-4ba8-835e-5532469c96a6.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_937%2Climit_0)

解决方案

![image.png](https://cdn.nlark.com/yuque/0/2022/png/26770555/1669261508796-2a7e4371-9ad7-466a-9e8b-533fb6679221.png?x-oss-process=image%2Fformat%2Cwebp%2Fresize%2Cw_937%2Climit_0)

## Session 共享实现使用Redis

如何共享存储？

1. Redis（基于内存的 K / V 数据库）此处选择 Redis，因为用户信息读取 / 是否登录的判断极其**频繁** ，Redis 基于内存，读写性能很高，简单的数据单机 qps 5w - 10w
2. MySQL 
3. 文件服务器 ceph


 官网：https://redis.io/

redis 管理工具 quick redis：https://quick123.net/

Redis 5.0.14 下载：

链接：https://pan.baidu.com/s/1XcsAIrdeesQAyQU2lE3cOg

提取码：vkoi 

1. 引入 redis，能够操作 redis：

